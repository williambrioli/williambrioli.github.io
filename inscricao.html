<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inscri√ß√£o</title>

<style>
* { box-sizing: border-box; }
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card {
  display: none;
  background: #fff;
  padding: 25px;
  max-width: 420px;
  width: 100%;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,.1);
}

.loader {
  font-size: 18px;
  color: #1f3c88;
}

input, select, button {
  width: 100%;
  padding: 14px;
  margin-bottom: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

input.erro {
  border-color: red;
}

button {
  background: linear-gradient(135deg, #1f3c88, #2f55d4);
  color: #fff;
  border: none;
  font-weight: bold;
}

button,
.btn {
  transition: 
    transform 0.1s ease,
    box-shadow 0.1s ease,
    opacity 0.2s ease;
}

button:active,
.btn:active {
  transform: scale(0.96);
  box-shadow: 0 2px 6px rgba(0,0,0,.2) inset;
  opacity: 0.85;
}


.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.modal-content {
  background: #fff;
  padding: 24px;
  border-radius: 14px;
  max-width: 420px;
  width: 100%;
  animation: fadeIn .25s ease;
}

.modal-content h3 {
  margin-bottom: 15px;
  color: #1f3c88;
}

.modal-content p {
  margin: 6px 0;
  font-size: 15px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(.95); }
  to { opacity: 1; transform: scale(1); }
}
  
</style>
</head>

<body>

<div class="loader" id="loader">üîé Validando link de inscri√ß√£o‚Ä¶</div>

<div class="card" id="formCard">
  <h2 id="titulo"></h2>

  <input id="nome" placeholder="Seu Nome Completo">
  <input id="cpf" placeholder="CPF (somente n√∫meros)">
  <input id="email" placeholder="Seu Melhor E-mail">
  <input id="telefone" placeholder="Telefone/WhatsApp">
  


<select id="pais">
  <option value="">Pa√≠s</option>
  <option value="BR">Brasil</option>
  <option value="JP">Jap√£o</option>
  <option value="PY">Paraguai</option>
</select>


  
<select id="estado" disabled>
  <option value="">Estado / Regi√£o</option>
</select>

<input
  id="estadoOutro"
  placeholder="Digite o estado / regi√£o"
  style="display:none">


<select id="cidade" disabled>
  <option value="">Cidade</option>
</select>

<input
  id="cidadeOutra"
  placeholder="Digite a cidade"
  style="display:none"
>

<button onclick="finalizar()">CONFIRMAR INSCRI√á√ÉO</button>
</div>

<script src="js/localidades.js"></script>

  
<script>
const params = new URLSearchParams(location.search);
const TOKEN = params.get("token");

if (!TOKEN) {
  document.body.innerHTML = "<h2>Link inv√°lido ou expirado.</h2>";
}

let ENDPOINT="", NOME_CURSO="", CARGA_HORARIA="", LOCAL_CURSO="", DATA_HORARIO_CURSO="", TURMA="";

fetch(`https://script.google.com/macros/s/AKfycbxB6mH2EqLyjQaUtMPMyx-GNLzHColazB0awBetRDG_Un3lCvYaF0tHRATIWOa7Iu6HsQ/exec?token=${TOKEN}`)
  .then(r => r.json())
  .then(data => {
    if (!data.sucesso) {
      document.body.innerHTML = "<h2>Link inv√°lido ou expirado.</h2>";
      return;
    }

    NOME_CURSO = data.nomeCurso;
    CARGA_HORARIA = data.cargaHoraria;
    LOCAL_CURSO = data.localCurso;
    DATA_HORARIO_CURSO = data.dataHorarioCurso;
    TURMA = data.turma;
    ENDPOINT = data.endpoint;

    document.getElementById("titulo").innerText = `Inscri√ß√£o ‚Äì ${NOME_CURSO}`;
    document.getElementById("loader").style.display = "none";
    document.getElementById("formCard").style.display = "block";
  })
  .catch(err => {
    console.error("Erro na valida√ß√£o:", err);
    document.body.innerHTML = "<h2>Erro ao validar inscri√ß√£o. Tente novamente.</h2>";
  });

// ===== VALIDA√á√ïES =====

const nomeEl = document.getElementById("nome");
const cpfEl = document.getElementById("cpf");
const emailEl = document.getElementById("email");
const telefoneEl = document.getElementById("telefone");
const paisEl = document.getElementById("pais");
const estadoEl = document.getElementById("estado");
const cidadeEl = document.getElementById("cidade");
const cidadeOutraEl = document.getElementById("cidadeOutra");
const estadoOutroEl = document.getElementById("estadoOutro");


  

nomeEl.oninput = e => e.target.value = e.target.value.replace(/[^A-Za-z√Ä-√ø ]/g,'').toUpperCase();
cidadeEl.oninput = e => e.target.value = e.target.value.replace(/[^A-Za-z√Ä-√ø ]/g,'').toUpperCase();
telefoneEl.oninput = e => e.target.value = e.target.value.replace(/\D/g,'');
cpfEl.oninput = e => {
  e.target.value = e.target.value.replace(/\D/g, '').slice(0, 11);
};

  estadoOutroEl.oninput = e => {e.target.value = e.target.value.replace(/[^A-Za-z√Ä-√ø ]/g,'').toUpperCase();
};
  
cidadeOutraEl.oninput = e => {e.target.value = e.target.value.replace(/[^A-Za-z√Ä-√ø ]/g,'').toUpperCase();
};
  

cpfEl.onblur = () => cpfEl.classList.toggle("erro", !validarCPF(cpfEl.value));
emailEl.oninput = e => {
  e.target.value = e.target.value.toLowerCase();
};

emailEl.onblur = () => {
  emailEl.classList.toggle(
    "erro",
    !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailEl.value)
  );
};

function validarCPF(cpf) {
  cpf = cpf.replace(/\D/g,'');
  if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false;
  let soma = 0, resto;
  for (let i=1;i<=9;i++) soma += parseInt(cpf[i-1])*(11-i);
  resto = (soma*10)%11;
  if (resto===10) resto=0;
  if (resto!=cpf[9]) return false;
  soma=0;
  for (let i=1;i<=10;i++) soma += parseInt(cpf[i-1])*(12-i);
  resto = (soma*10)%11;
  if (resto===10) resto=0;
  return resto==cpf[10];
}



 paisEl.onchange = () => {

  // üîπ define o r√≥tulo correto conforme o pa√≠s
  estadoEl.innerHTML =
    paisEl.value === "JP"
      ? `<option value="">Prefeitura</option>`
      : paisEl.value === "PY"
      ? `<option value="">Departamento</option>`
      : `<option value="">Estado</option>`;


// üîπ r√≥tulo da CIDADE conforme o pa√≠s
cidadeEl.placeholder =
  paisEl.value === "JP"
    ? "Â∏Ç (Cidade)"
    : paisEl.value === "PY"
    ? "Ciudad"
    : "Cidade";
   

  estadoEl.disabled = true;
  cidadeEl.value = "";
  cidadeEl.disabled = true;

  const lista = ESTADOS[paisEl.value];

  if (!lista) return;

  lista.forEach(([valor, nome]) => {
    const opt = document.createElement("option");
    opt.value = valor;
    opt.textContent = nome;
    estadoEl.appendChild(opt);
  
  });

    const optOutroEstado = document.createElement("option");
    optOutroEstado.value = "OUTRO";
    optOutroEstado.textContent = "OUTRO";
    estadoEl.appendChild(optOutroEstado);

   
  estadoEl.disabled = false;
};




  
 
estadoEl.onchange = () => {
  // reset estado outro
  estadoOutroEl.style.display = "none";
  estadoOutroEl.value = "";

  // reset cidade (SEM FOR√áAR OUTRA)
  cidadeEl.innerHTML = `<option value="">Cidade</option>`;
  cidadeEl.disabled = true;
  cidadeOutraEl.style.display = "none";
  cidadeOutraEl.value = "";

  if (!estadoEl.value) return;

  // üü° ESTADO = OUTRO ‚Üí s√≥ abre o campo de estado
  if (estadoEl.value === "OUTRO") {
    estadoOutroEl.style.display = "block";
    estadoOutroEl.focus();

    // cidade fica dispon√≠vel, mas neutra
    cidadeEl.disabled = false;

    const optOutra = document.createElement("option");
    optOutra.value = "OUTRA";
    optOutra.textContent = "OUTRA";
    cidadeEl.appendChild(optOutra);

    return;
  }

  // üü¢ ESTADO NORMAL ‚Üí carrega cidades
  const listaCidades = CIDADES[paisEl.value]?.[estadoEl.value];

  if (listaCidades) {
    listaCidades.forEach(cidade => {
      const opt = document.createElement("option");
      opt.value = cidade;
      opt.textContent = cidade;
      cidadeEl.appendChild(opt);
    });
  }

  // adiciona OUTRA como op√ß√£o
  const optOutra = document.createElement("option");
  optOutra.value = "OUTRA";
  optOutra.textContent = "OUTRA";
  cidadeEl.appendChild(optOutra);

  cidadeEl.disabled = false;
};


cidadeEl.onchange = () => {
  if (cidadeEl.value === "OUTRA") {
    cidadeOutraEl.style.display = "block";
    cidadeOutraEl.focus();
  } else {
    cidadeOutraEl.style.display = "none";
    cidadeOutraEl.value = "";
  }
};


   
function finalizar() {


// üî¥ VALIDA NOME (OBRIGAT√ìRIO)
  
 if (!nomeEl.value.trim()) {
  alert("‚ö†Ô∏è Informe o nome do participante.");
  nomeEl.classList.add("erro");
  nomeEl.focus();
  return;
} else {
  nomeEl.classList.remove("erro");
}
  
  
  
  
  // üî¥ VALIDA EMAIL (OBRIGAT√ìRIO)
if (!emailEl.value.trim()) {
  alert("‚ö†Ô∏è Informe o e-mail.");
  emailEl.classList.add("erro");
  emailEl.focus();
  return;
}

if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailEl.value)) {
  alert("‚ö†Ô∏è Informe um e-mail v√°lido.");
  emailEl.classList.add("erro");
  emailEl.focus();
  return;
} else {
  emailEl.classList.remove("erro");
}
  
  
    
  
  // üî¥ VALIDA TELEFONE (OBRIGAT√ìRIO)
if (!telefoneEl.value.trim()) {
  alert("‚ö†Ô∏è Informe o telefone / WhatsApp.");
  telefoneEl.classList.add("erro");
  telefoneEl.focus();
  return;
}

// m√≠nimo 10 d√≠gitos (DDD + n√∫mero)
if (telefoneEl.value.length < 10) {
  alert("‚ö†Ô∏è Informe um telefone v√°lido com DDD.");
  telefoneEl.classList.add("erro");
  telefoneEl.focus();
  return;
} else {
  telefoneEl.classList.remove("erro");
} 


  
  
// üî¥ VALIDA PA√çS
if (!paisEl.value) {
  alert("‚ö†Ô∏è Selecione o pa√≠s.");
  paisEl.focus();
  return;
}

// üî¥ VALIDA ESTADO / PREFEITURA / DEPARTAMENTO
if (
  !estadoEl.value ||
  (estadoEl.value === "OUTRO" && !estadoOutroEl.value.trim())
) {
  alert("‚ö†Ô∏è Informe o estado / regi√£o.");
  estadoEl.focus();
  return;
}

// üî¥ VALIDA CIDADE
if (
  !cidadeEl.value ||
  (cidadeEl.value === "OUTRA" && !cidadeOutraEl.value.trim())
) {
  alert("‚ö†Ô∏è Informe a cidade.");
  cidadeEl.classList.add("erro");
  cidadeEl.focus();
  return;
} else {
  cidadeEl.classList.remove("erro");
}



  
  if (document.querySelector(".erro")) {
    alert("‚ö†Ô∏è Corrija os campos destacados.");
    return;
  }

  fetch(ENDPOINT, {
  method: "POST",
  body: JSON.stringify({
    token: TOKEN,
    nome: nomeEl.value.toUpperCase(),
    cpf: cpfEl.value.replace(/\D/g,''),
    email: emailEl.value.toLowerCase(),
    telefone: telefoneEl.value,
    cidade: cidadeEl.value === "OUTRA"
    ? cidadeOutraEl.value.toUpperCase()
    : cidadeEl.value.toUpperCase(),
    estado:
  estadoEl.value === "OUTRO"
    ? estadoOutroEl.value.toUpperCase()
    : estadoEl.value,

    // üî¥ CAMPOS QUE ALIMENTAM H ‚Üí O (OBRIGAT√ìRIOS)
    nomeCurso: NOME_CURSO,
    cargaHoraria: CARGA_HORARIA,
    localCurso: LOCAL_CURSO,
    dataHorarioCurso: DATA_HORARIO_CURSO,
    turma: TURMA
  })
})
.then(r => r.json())
.then(res => {
  if (res.sucesso) {
    document.getElementById("mNome").innerText = nomeEl.value;
    document.getElementById("mCurso").innerText = NOME_CURSO;
    document.getElementById("mTurma").innerText = TURMA || "-";
    document.getElementById("mCarga").innerText = CARGA_HORARIA || "-";
    document.getElementById("mLocal").innerText = LOCAL_CURSO || "-";
    document.getElementById("mData").innerText = DATA_HORARIO_CURSO || "-";

    document.getElementById("modal").style.display = "flex";
  }
});
} 

  
</script>


<script>
function fecharModal() {
  // Fecha o modal
  document.getElementById("modal").style.display = "none";

  // Recarrega a p√°gina ap√≥s fechar o modal
  setTimeout(function () {
    window.location.reload();
  }, 200);
}
</script>


<div class="modal" id="modal">
  <div class="modal-content">
    <h3>üéâ Parab√©ns por esta escolha!</h3>
    <p><b>Inscri√ß√£o confirmada.</b> Voc√™ receber√° o voucher por e-mail.</p>
    <hr>
    <p><b>Participante:</b> <span id="mNome"></span></p>
    <p><b>Curso:</b> <span id="mCurso"></span></p>
    <p><b>Turma:</b> <span id="mTurma"></span></p>
    <p><b>Carga hor√°ria:</b> <span id="mCarga"></span></p>
    <p><b>Local:</b> <span id="mLocal"></span></p>
    <p><b>Dia(s):</b> <span id="mData"></span></p>
    <br>
    <button onclick="fecharModal()">FECHAR</button>
  </div>
</div>

  
</body>
</html>
